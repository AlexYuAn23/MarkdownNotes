# Linux 文件系统

在 Linux 中，文件的定义是十分宽泛的，即万物皆文件。简单来说就是：

- 文件可以是任意源，有一个名称，可以从中读取数据；
- 文件可以是任意目标，有一个名称，可以向其中写入数据。

因此在 Linux 系统中，文件并不只是指磁盘文件那样的数据存储库，还可以是任意物理设备，如键盘（输入源），显示器（输出源）等。这种宽泛的文件定义方式意味着 **Linux 程序可以使用简单过程从任意的输入源读取数据，或者向任意的输出目标写入数据。**



## 文件分类

- **普通文件**

	- 文本文件
	- 二进制文件

- **目录**

	- 不存放常规数据，用来组织、访问其他文件。

- **伪文件**

	- 特殊文件：

		- 表示物理设备的伪文件，存放在 /dev 目录下；
		- 分为硬件、终端、伪设备；
		- 伪设备是一个充当输入源或输出目标的文件，并不对应实际设备，最有用的是 /dev/null 和 /dev/zero，任何写入到这两个设备的内容都会被抛弃，它们之间的区别在读取上：
			- /dev/null：读取 /dev/null 不返回任何东西；
			- /dev/zero：读取 /dev/zero 会返回和请求一样多的 null 字符，这个特性可以用来清除磁盘上的内容，可以使用 null 字符覆盖已有的数据，即从 /dev/zero 中向需要清空的磁盘输出足够多的字符，是一个稳定的 null 源；
			- 总结：null 文件不返回任何东西，zero 文件返回 null。

	- 命名管道

		- 可以使用命名管道进行进程间的通信

			```shell
			$ mkfifo fifotest                   # 创建命名管道
			$ grep bash /etc/passwd > fifotest  # 将内容输入管道
			$ wc -l < fifotest                  # 将管道中的内容取出
			$ rm fifotest                       # 删除管道
			```

	- proc 文件

		- proc 文件系统是为了提取进程的信息而开发的；

			```shell
			$ ls -l /proc/kcore  # 这个文件的大小表示计算机的实际物理内存，虽然看着很大，不过这是个伪文件，是不占空间的
			```

		- 所有的 proc 文件都存放在 /proc 目录中。这个目录中可以发现系统中每个进程对应一个子目录，子目录的名字就是进程的 pid，如 /proc/1952；

		- ps 程序正是通过读取合适的 proc 文件，收集所需的数据的。

> 在 Linux 系统中，每个对象不是由文件表示，就是由进程表示，简单来说就是：
>
> - 文件存储数据，或者允许访问资源；
> - 进程是正在执行的程序。



## 挂载文件系统：mount & umount

在 Linux 文件系统中，数十万个文件组织成了一颗非常大的树，树的根就是根目录。不过在大多数情况下，并不是所有的文件都存储在一块物理设备上的，准确的说，文件存储在许多不同类型的设备上，包括多个磁盘分区。

每个存储设备都有自己的本地文件系统，即有自己的树，可是为了能访问这个存储设备的文件系统，我们需要将它的树挂在我们的主树上，即 **将这个小型文件系统的根目录连接到主文件系统中的特定目录上**。这一过程就叫做挂载（mount），小文件系统在主树上挂着的目录则称为挂载点，而断开这一连接的过程则称为卸载（umount）。

挂载命令：

```shell
$ mount /dev/fd0 /media/floppy
```

广义的讲，存储设备有以下两种类型，由于文件系统存在消失的可能性，所以文件系统层次结构标准要求使用特定的目录挂载文件系统：

- 固定介质（fixed media）：永久附属于计算机，例如硬盘驱动器，指定挂载目录是 /mnt，不能挂载在其他位置上；
- 可移动介质（removable media）：在系统运行时可以改变，例如 U 盘、存储卡等，指定挂载目录是 /media。



## 根目录中的内容

| 目录        | 内容                                   |
| ----------- | -------------------------------------- |
| /           | 根目录                                 |
| /bin        | 基本程序                               |
| /boot       | 启动系统时所需的文件                   |
| /dev        | 设备文件                               |
| /etc        | 配置文件                               |
| /home       | 用户的 home 目录                       |
| /lib        | 基本共享库，内核模块                   |
| /lost+found | 由 fsck 恢复的受损文件                 |
| /media      | 可移动介质挂载点                       |
| /mnt        | 不能挂载在其他位置上的固定介质的挂载点 |
| /opt        | 第三方应用程序                         |
| /proc       | proc 文件                              |
| /root       | root 用户的 home 目录                  |
| /sbin       | 由 root 用户运行的基本系统管理程序     |
| /src        | 本地系统所提供服务的数据               |
| /tmp        | 临时文件                               |
| /usr        | 静态数据使用的辅助文件系统             |
| /var        | 可变数据使用的辅助文件系统             |

### /usr 目录

/usr 和 /var 都是集成到主文件系统中的单独文件系统挂载点，不过 /usr 针对静态数据，/var 针对可变数据，都是用来存放系统数据的（与系统数据相对应的是用户数据，它们存放在 /home 目录中）。

**/usr 目录的内容**

| 目录         | 内容                                                         |
| ------------ | ------------------------------------------------------------ |
| /usr/bin     | 非基本程序（大多数的用户程序），比 /bin 包含更多的程序       |
| /usr/include | C 程序的头文件                                               |
| /usr/lib     | 非基本共享库                                                 |
| /usr/local   | 本地安装程序                                                 |
| /usr/sbin    | 由 root 用户运行的非基本系统管理程序                         |
| /usr/share   | 共享系统数据，存了许多静态数据，如文档、字体、图标等，需要在用户和程序之间共享 |
| /usr/src     | 源代码（只用于参考）                                         |

### 存放程序的目录

- **通用程序**
	- /bin：基本程序
	- /usr/bin：非基本程序
	- /usr/local/bin：本地安装程序
- **系统管理程序**
	- /sbin：由 root 用户运行的基本系统管理程序
	- /usr/sbin：由 root 用户运行的非基本系统管理程序
	- /usr/local/sbin：本地安装的系统程序
- **第三方应用程序**
	- /opt/xxx：应用程序 xxx 的静态数据，包括程序
	- /var/opt/xxx：应用程序 xxx 的可变数据